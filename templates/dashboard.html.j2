{% extends "base.html.j2" %} 
{% block title %}Dashboard - CuraVie{% endblock %}

{% block content %}
<div class="container dashboard-container">
    <div class="dashboard-header">
        <h1><span data-translate-key="dashboard_welcome">Welcome</span>, {{ current_user.username }}!</h1>
    </div>

    <div class="card">
        {% if current_user.worker %}
            <div class="profile-summary">
                <h2 data-translate-key="dashboard_profile_summary">Profile Summary</h2>
                
                <div class="profile-details-grid">
                    <p><strong>Name:</strong> {{ current_user.worker.first_name }} {{ current_user.worker.last_name }}</p>
                    <p><strong>Age:</strong> {{ current_user.worker.age }}</p>
                    <p><strong>Occupation:</strong> {{ current_user.worker.occupation.value }}</p>
                    <p><strong>Home State:</strong> {{ current_user.worker.home_state }}</p>
   
                    <p><strong>Phone:</strong> {{ current_user.worker.phone }}</p>
                    <p><strong>Smoking Habit:</strong> {{ current_user.worker.smoking_habit.value }}</p>
                </div>
            </div>

            <hr style="margin: 1.5rem 0;">

            <div class="dashboard-actions">
                <h2 data-translate-key="dashboard_actions_title">Actions</h2>
                <div class="action-buttons">
                    <a href="{{ url_for('edit_details') }}" class="btn btn-secondary" data-translate-key="dashboard_edit_details">Edit Profile</a>
                    <a href="{{ url_for('add_health_record') }}" class="btn btn-secondary" data-translate-key="dashboard_add_health_record">Add Health Record</a>
           
                    <a href="{{ url_for('log_activity') }}" class="btn btn-secondary" data-translate-key="dashboard_log_activity">Log Activity</a>
                    <a href="{{ url_for('add_vaccination') }}" class="btn btn-secondary" data-translate-key="dashboard_add_vaccination">Add Vaccination</a>
                    
                    {# This button only shows for users with the 'health_official' role #}
      
                    {% if current_user.role.value == 'health_official' %}
                        <a href="{{ url_for('register_facility') }}"  class="btn btn-secondary" data-translate-key="dashboard_register_facility">Register/Edit Facility</a>
                    {% endif %}
                </div>
            </div>

        {% else %}
            <div class="no-profile-cta">
                <h2 data-translate-key="dashboard_get_started">Get Started</h2>
                <p data-translate-key="dashboard_no_details">You have not filled out your worker details yet.
                Please create your profile to access all features.</p>
                <a href="{{ url_for('worker_details') }}" class="btn btn-primary" data-translate-key="dashboard_create_profile">Create Your Profile Now</a>
            </div>
        {% endif %}
    </div>

    <div id="report-generating-notification" class="flash-message info" style="display: none;">
    Generating your health report... This may take a moment.
    </div>

    {% if current_user.worker %}
    
    <div class="card mt-4">
        <h2 data-translate-key="dashboard_ai_report_title">AI Health Assessment</h2>
        <p data-translate-key="dashboard_ai_report_description">Get a personalized health risk assessment and recommendations based on your profile.</p>
        <div class="action-buttons mt-2">
            <a href="{{ url_for('generate_report') }} " id="generate-report-btn" class="btn btn-primary">
                Generate & Download Report
            </a>
        </div>
    </div>
    {% endif %}
</div>


<script>
    const generateBtn = document.getElementById('generate-report-btn');
    const notification = document.getElementById('report-generating-notification');

    generateBtn.addEventListener('click', function() {
        notification.style.display = 'block';
    });
</script>
{% endblock %}